/*! navitron 0.0.1 (https://github.com/mobify/navitron.git) */
!function(a){if("function"==typeof define&&define.amd)define(["$","plugin","velocity"],a);else{var b=window.Zepto||window.jQuery;a(b,window.Plugin,window.Velocity)}}(function(a,b,c){function d(a,b){d.__super__.call(this,a,b,d.DEFAULTS)}var e={PANE:".navitron__pane",NESTED_PANE:".navitron__nested > .navitron__pane",ITEM:".navitron__item",NEXT_PANE:".navitron__next-pane",PREV_PANE:".navitron__prev-pane",CONTENT:".navitron__content"},f={ANIMATING:"navitron--is-animating",NEXT_PANE:"navitron__next-pane"};return d.VERSION="0.0.1",d.DEFAULTS={shiftAmount:20,duration:200,easing:"swing",fadeOpacityTo:.25,structure:!1,slideDirection:"left",onShow:a.noop,onShown:a.noop},b.create("navitron",d,{_init:function(b){this.$original=a(b),this._validateOptions(),this._build(),this.$currentPane=this._getTargetPane(0),this._setAnimationDefaults(),this.$listItems=this.$original.find(e.ITEM),this.$visibleItems=this.$currentPane.find(e.ITEM),this._bindEvents()},destroy:function(){this.$navitron.removeData(this.name)},_build:function(){var b=this,c=this.$original.addClass("navitron"),d=a("<div />").addClass("navitron__nested"),e=a("<div />").addClass("navitron__pane"),f=a("<div />").addClass("navitron__wrapper"),g=(a('<button type="button" />').addClass("navitron__item"),c.children("ul")),h=g.children("li");b._setLevelData();var i=g.attr("data-level");g.removeAttr("data-level"),c.children("ul").addClass("navitron__content").wrap(f.clone()).parent().wrap(e.clone().attr("data-level",i)),b.options.structure&&b._includeCustomMarkup(g),this._setDirection(d),d.appendTo(c),this._buildNestedLevels(h,d),c.find("button, a").addClass("navitron__item"),this.$navitron=c,this._addAccessibility(),this.$navitron.removeAttr("hidden")},_setDirection:function(a){var b,c=this;"left"===c.options.slideDirection?(b="100%",c.oppositePanePosition="-100%",c.shiftValue=this.options.shiftAmount):"right"===c.options.slideDirection&&(b="-100%",c.oppositePanePosition="100%",c.shiftValue=0),a.css({"-webkit-transform":"translate3d("+b+", 0, 0)",transform:"translate3d("+b+", 0, 0)"})},_buildNestedLevels:function(b,c){var d=this,e=a("<div />").addClass("navitron__pane"),f=a("<div />").addClass("navitron__wrapper"),g=a('<button type="button" />').addClass("navitron__item");b.each(function(b,h){var i=a(h),j=i.children("ul").addClass("navitron__content").remove();if(j.length){var k=j.data("level"),l=d._getParentLevel(k);if(j.removeAttr("data-level"),j.wrap(f.clone()).parent().wrap(e.clone()).parent().attr("data-level",k).appendTo(c),d.options.structure){if(d._includeCustomMarkup(j,k,l),!i.find(".navitron__next-pane").length)throw new Error('Custom structure requires element with class "navitron__next-pane" for nested lists');i.find(".navitron__next-pane").addClass("navitron__item").attr("data-target-pane",k)}else{var m=g.clone().text("Back").addClass("navitron__prev-pane").attr("data-target-pane",l).attr("data-current-pane",k);m.wrap('<div class="navitron__header" />').parent().insertBefore(j);var n=i.text().trim();i.html(g.clone().text(n).attr("data-target-pane",k).addClass("navitron__next-pane"))}var o=j.children("li");o.length&&d._buildNestedLevels(o,c)}})},_includeCustomMarkup:function(a,b,c){var d=a.children(".navitron__header").remove(),e=a.children(".navitron__footer").remove();if(d.length){var f=this._buildHeaderFooter(d,c,b);f.insertBefore(a)}if(e.length){var g=this._buildHeaderFooter(e,c,b);g.insertAfter(a)}return a},_buildHeaderFooter:function(b,c,d){for(var e,f,g="",h=b[0].attributes.length,i=b.find(".navitron__prev-pane"),j=0;h>j;j++)e=b[0].attributes[j].nodeName,f=b[0].attributes[j].nodeValue,g+=e+'="'+f+'" ';var k=a("<div "+g+" />");return i.length&&i.addClass("navitron__item").attr("data-target-pane",c).attr("data-current-pane",d),b.contents().appendTo(k),k},_getParentLevel:function(a){var b=a.toString().split(".");return b.pop(),b.join(".")},_setLevelData:function(){var b,c=this.$original.children("ul"),d="> li > ul ";for(c.attr("data-level","0");;){var e=c.find(d),f=0;if(!e.length)break;e.each(function(c,d){var e=a(d),g=e.parents("ul").first(),h=g.data("level"),i=parseInt(h.toString().split(".").pop());i!==b&&(b=i,f=0),e.attr("data-level",h+"."+f),f++}),d+="> li > ul"}},_addAccessibility:function(){this.$navitron.attr("role","tree"),this.$navitron.find(e.PANE).attr("aria-hidden","false"),this.$navitron.find(e.NESTED_PANE).each(function(b,c){var d=a(c),e=d.data("level");d.attr("role","group").attr("aria-hidden","true").attr("id","Navitron_"+e)}),this.$navitron.find(e.ITEM).attr("role","treeitem"),this.$navitron.find(e.NEXT_PANE).each(function(b,c){var d=a(c),e=d.data("target-pane");d.attr("aria-expanded","false").attr("aria-owns","Navitron_"+e)})},_validateOptions:function(){if(this.options.fadeOpacityTo<0||this.options.fadeOpacityTo>1)throw new Error("The fadeOpacityTo value should be in the range from 0 to 1.0.");if("left"!==this.options.slideDirection&&"right"!==this.options.slideDirection)throw new Error("The slideDirection should be set to left or right.")},_setAnimationDefaults:function(){this.animationDefaults={easing:this.options.easing,duration:this.options.duration,mobileHA:!0}},_bindEvents:function(){var b=this;this.$navitron.on("click",e.NEXT_PANE,function(){var c=a(this),d=c.data(),e=b._getTargetPane(d.targetPane);if(c.is("a")||c.has("a").length||!e.length){if(!e.length)throw new Error("Target pane with ID: "+d.targetPane+" does not exist!")}else b.showPane(e),c.attr("aria-expanded","true")}),this.$navitron.on("click",e.PREV_PANE,function(){var c=a(this);b._hidePane(b.$currentPane,c)}),this.$navitron.on("keydown",e.PANE,function(c){b._handleKeyDown(a(this),c)})},_handleKeyDown:function(a,b){var c=a.find(e.CONTENT),d=c.find(e.ITEM),g=this.$visibleItems.filter(":focus"),h=this.$visibleItems.length-1,i=this.$visibleItems.index(g);if(32===b.which&&(g.trigger("click"),b.preventDefault()),37===b.which){var j=a.find(e.PREV_PANE);j.length&&j.trigger("click"),b.preventDefault()}39===b.which&&g.hasClass(f.NEXT_PANE)&&(g.trigger("click"),b.preventDefault()),this._handleNextPrevItem(b,c,d,h,i)},_handleNextPrevItem:function(a,b,c,d,f){38===a.which&&(b.is(":focus")&&(f=this.$visibleItems.index(c)),f>0&&this.$visibleItems[f-1].focus(),a.preventDefault()),40===a.which&&d>f&&(b.is(":focus")?(f=this.$visibleItems.index(c),this.$visibleItems[f].focus()):this.$visibleItems[f+1].focus(),a.preventDefault()),40===a.which&&d===f&&(this.$visibleItems.filter(e.PREV_PANE).focus(),a.preventDefault())},showPane:function(b){if(!b.length)throw new Error("The showPane method requires a pane element to show");if(!this.$navitron.hasClass(f.ANIMATING)){var d=this,g=this.$currentPane,h=this._getTranslateX(g);c.animate(b,{translateX:[d.oppositePanePosition,0]},a.extend(!0,{},this.animationDefaults,{display:"block",begin:function(){d.$navitron.addClass(f.ANIMATING),d._trigger("onShow",{pane:b})},complete:function(){window.requestAnimationFrame(function(){d.$navitron.removeClass(f.ANIMATING),b.attr("aria-hidden","false"),d._setCurrentPane(b),d.setFocusableItems(b),b.find(e.CONTENT).attr("tabindex",0).focus(),d._trigger("onShown",{pane:b})})}})),c.animate(g,{translateX:[h-d.shiftValue+"%",h+"%"],opacity:[this.options.fadeOpacityTo,1]},a.extend(!0,{},this.animationDefaults,{display:"none",complete:function(){g.attr("aria-hidden","true")}}),{queue:!1})}},_hidePane:function(b,d){var e=this;this.$navitron.hasClass(f.ANIMATING)||(c.animate(b,{translateX:[0,e.oppositePanePosition]},a.extend(!0,{},this.animationDefaults,{display:"none",complete:function(){b.attr("aria-hidden","true")}})),e._showPreviousPane(d))},_showPreviousPane:function(b){var d=this,g=b.data(),h=this._getTargetPane(g.targetPane),i=this._getTranslateX(h);h.attr("style").length<1&&(i=-(100+d.shiftValue)),c.animate(h,{translateX:[i+d.shiftValue+"%",i+"%"],opacity:[1,this.options.fadeOpacityTo]},a.extend(!0,{},this.animationDefaults,{display:"block",begin:function(){d.$navitron.addClass(f.ANIMATING),d._trigger("onShow",{pane:h})},complete:function(){window.requestAnimationFrame(function(){d.$navitron.removeClass(f.ANIMATING),h.attr("aria-hidden","false").find(e.NEXT_PANE+'[data-target-pane="'+g.currentPane+'"]').attr("aria-expanded","false").focus(),d._setCurrentPane(h),d._trigger("onShown",{pane:h}),d.setFocusableItems(h)})}}))},setFocusableItems:function(a){this.$visibleItems=a.find(e.ITEM)},_setCurrentPane:function(a){this.$currentPane=a},_getTargetPane:function(a){return this.$navitron.find(e.PANE+'[data-level="'+a+'"]')},_getTranslateX:function(a){return parseFloat(c.CSS.getPropertyValue(a[0],"translateX"))}}),a("[data-navitron]").navitron(),a});