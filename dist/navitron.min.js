/*! navitron 0.0.1 (https://github.com/mobify/navitron.git) */
!function(a){if("function"==typeof define&&define.amd)define(["$","plugin","velocity"],a);else{var b=window.Zepto||window.jQuery;a(b,window.Plugin,window.Velocity)}}(function(a,b,c){function d(a,b){d.__super__.call(this,a,b,d.DEFAULTS)}var e={PANE:".navitron__pane",NESTED_PANE:".navitron__nested > .navitron__pane",ITEM:".navitron__item",NEXT_PANE:".navitron__next-pane",PREV_PANE:".navitron__prev-pane",HEADER:".navitron__header",CONTENT:".navitron__content",FOOTER:".navitron__footer",CURRENT_PANE:".navitron--current-pane"},f={NAVITRON:"navitron",ANIMATING:"navitron--is-animating",NESTED_CONTAINER:"navitron__nested",PANE:"navitron__pane",WRAPPER:"navitron__wrapper",HEADER:"navitron__header",CONTENT:"navitron__content",FOOTER:"navitron__footer",NEXT_PANE:"navitron__next-pane",PREV_PANE:"navitron__prev-pane",ITEM:"navitron__item",CURRENT_PANE:"navitron--current-pane",SLID_PANE:"navitron--slid-pane",DISMISS_PANE:"navitron--dismiss-pane"},g={NESTED_CONTAINER:'<div class="'+f.NESTED_CONTAINER+'"></div>',PANE:'<div class="'+f.PANE+'"></div>',WRAPPER:'<div class="'+f.WRAPPER+'"></div>',HEADER:'<div class="'+f.HEADER+'"></div>',CONTENT:'<div class="'+f.CONTENT+'"></div>',FOOTER:'<div class="'+f.FOOTER+'"></div>',BUTTON:'<button type="button" class="'+f.ITEM+'"></button>'};return d.VERSION="0.0.1",d.DEFAULTS={shiftAmount:20,duration:200,easing:"swing",fadeOpacityTo:.25,structure:!0,onShow:a.noop,onShown:a.noop},b.create("navitron",d,{_init:function(b){this.$original=a(b),this._validateOptions(),this._build(),this.$currentPane=this._getTargetPane(0),this._setAnimationDefaults(),this.$visibleItems=this.$currentPane.find(e.ITEM),this._bindEvents()},destroy:function(){this.$navitron.removeData(this.name)},_setAnimationDirection:function(a,b){return a.hasClass(f.CURRENT_PANE)&&!b.hasClass(f.SLID_PANE)?{startX:"0",endX:-1*this.options.shiftAmount+"%",startOpacity:"1",endOpacity:this.options.fadeOpacityTo,cssClass:f.SLID_PANE}:a.hasClass(f.SLID_PANE)?{startX:-1*this.options.shiftAmount+"%",endX:"0",startOpacity:this.options.fadeOpacityTo,endOpacity:"1"}:a.hasClass(f.DISMISS_PANE)||a.hasClass(f.CURRENT_PANE)&&b.hasClass(f.SLID_PANE)?{startX:"0",endX:"100%",startOpacity:"1",endOpacity:"1"}:{startX:"100%",endX:"0",startOpacity:"1",endOpacity:"1"}},showPane:function(b){if(!b.length)throw new Error("The showPane method requires a pane element to show");if(!this._isAnimating()&&!b.hasClass(f.CURRENT_PANE)){var d=this,g=d.$currentPane,h=this._setAnimationDirection(b),i=this._setAnimationDirection(g,b);c.animate(b,{translateX:[h.endX,h.startX],opacity:[h.endOpacity,h.startOpacity]},a.extend(!0,{},this.animationDefaults,{display:"block",begin:function(){window.requestAnimationFrame(function(){d.$navitron.addClass(f.ANIMATING),d._trigger("onShow",{pane:b})})},complete:function(){window.requestAnimationFrame(function(){if(d.$navitron.removeClass(f.ANIMATING),b.attr("aria-hidden","false"),d.setFocusableItems(b),b.find(e.CONTENT).attr("tabindex",0).focus(),b.find(e.NEXT_PANE+'[data-target-pane="'+d.$currentPane.data("level")+'"]').focus(),d._setCurrentPane(b),b.find(e.PREV_PANE).length){var a="#"+b.attr("id");history.pushState(null,null,a)}else history.pushState(null,null,window.location.pathname);d._trigger("onShown",{pane:b})})}})),c.animate(g,{translateX:[i.endX,i.startX],opacity:[i.endOpacity,i.startOpacity]},a.extend(!0,{},this.animationDefaults,{display:"none",complete:function(){window.requestAnimationFrame(function(){g.attr("aria-hidden","true").addClass(i.cssClass).removeClass(f.CURRENT_PANE).removeClass(f.DISMISS_PANE)})}}))}},_build:function(){var b=this,c=this.$original.addClass(f.NAVITRON),d=a(g.PANE),h=a(g.WRAPPER),i=a(g.CONTENT),j=(a(g.BUTTON),c.children("ul")),k=j.children("li");b._setLevelData();var l=j.attr("data-level");if(j.removeAttr("data-level"),j.wrapAll(i.clone()).parent().wrap(h.clone()).parent().wrap(d.clone().attr("data-level",l).addClass(f.CURRENT_PANE)),b.options.structure){if(c.find(e.PREV_PANE).length)throw new Error('Default structure option will generate its own `<button class="navitron__prev-pane" />`. Please remove the button from the markup or set structure option to `false` if you want control over the markup')}else b._includeCustomMarkup(j);this._buildNestedLevels(k),c.find("button, a").addClass(f.ITEM),this.$navitron=c,this._addAccessibility(),this.$navitron.removeAttr("hidden")},_buildNestedLevels:function(b){var c=this,d=a(g.PANE),h=a(g.WRAPPER),i=a(g.CONTENT),j=a(g.BUTTON);b.each(function(b,k){var l=a(k),m=l.children("ul");if(m.length){var n=m.data("level"),o=c._getParentLevel(n),p=l.contents().not(a(e.NEXT_PANE));if(m.removeAttr("data-level"),p.wrapAll(i.clone()).parent().wrap(h.clone()).parent().wrap(d.clone()).parent().attr("data-level",n).appendTo(c.$original),c.options.structure){var q=j.clone().text("Back").addClass(f.PREV_PANE).attr("data-target-pane",o).attr("data-current-pane",n);a(g.HEADER).append(q).insertBefore(m.parent(e.CONTENT));var r=l.text().trim();l.html(j.clone().text(r).attr("data-target-pane",n).addClass(f.NEXT_PANE))}else{if(c._includeCustomMarkup(m,n,o),!l.find(e.NEXT_PANE).length)throw new Error('Custom structure requires element with class "navitron__next-pane" for nested lists');l.find(e.NEXT_PANE).addClass(f.ITEM).attr("data-target-pane",n)}var s=m.children("li");s.length&&c._buildNestedLevels(s,c.$original)}})},_includeCustomMarkup:function(a,b,c){var d=a.children(e.HEADER).remove(),f=a.children(e.FOOTER).remove();if(d.length){var g=this._buildHeaderFooter(d,c,b);g.insertBefore(a.parent(e.CONTENT))}if(f.length){var h=this._buildHeaderFooter(f,c,b);h.insertAfter(a.parent(e.CONTENT))}return a},_buildHeaderFooter:function(b,c,d){for(var g,h,i="",j=b[0].attributes.length,k=b.find(e.PREV_PANE),l=0;j>l;l++)g=b[0].attributes[l].nodeName,h=b[0].attributes[l].nodeValue,i+=g+'="'+h+'" ';var m=a("<div "+i+" />");return k.length&&k.addClass(f.ITEM).attr("data-target-pane",c).attr("data-current-pane",d),b.contents().appendTo(m),m},_bindEvents:function(){var b=this;this.$navitron.on("click",e.NEXT_PANE,function(){var c=a(this),d=c.data(),e=b._getTargetPane(d.targetPane);if(c.is("a")||c.has("a").length||!e.length){if(!e.length)throw new Error("Target pane with ID: "+d.targetPane+" does not exist!")}else b.showPane(e),c.attr("aria-expanded","true")}),this.$navitron.on("click",e.PREV_PANE,function(){var c=a(this),d=c.data(),e=b._getTargetPane(d.targetPane);b.$currentPane.removeClass(f.CURRENT_PANE).addClass(f.DISMISS_PANE),b.showPane(e)}),this.$navitron.on("keydown",e.PANE,function(c){b._handleKeyDown(a(this),c)}),a(window).on("popstate",function(){b.$navitron.is(":visible")&&b.$currentPane.find(e.PREV_PANE).length?b.$currentPane.find(e.PREV_PANE).click():window.history.go(-1)})},_handleKeyDown:function(a,b){var c=a.find(e.CONTENT),d=c.find(e.ITEM),g=this.$visibleItems.filter(":focus"),h=this.$visibleItems.length-1,i=this.$visibleItems.index(g);if(32===b.which&&(g.trigger("click"),b.preventDefault()),37===b.which){var j=a.find(e.PREV_PANE);j.length&&j.trigger("click"),b.preventDefault()}39===b.which&&g.hasClass(f.NEXT_PANE)&&(g.trigger("click"),b.preventDefault()),this._handleNextPrevItem(b,c,d,h,i)},_handleNextPrevItem:function(a,b,c,d,f){38===a.which&&(b.is(":focus")&&(f=this.$visibleItems.index(c)),f>0&&this.$visibleItems[f-1].focus(),a.preventDefault()),40===a.which&&d>f&&(b.is(":focus")?(f=this.$visibleItems.index(c),this.$visibleItems[f].focus()):this.$visibleItems[f+1].focus(),a.preventDefault()),38===a.which&&0===f&&(this.$visibleItems.filter(e.ITEM).last().focus(),a.preventDefault()),40===a.which&&d===f&&(this.$visibleItems.filter(e.ITEM).eq(0).focus(),a.preventDefault())},setFocusableItems:function(a){this.$visibleItems=a.find(e.ITEM)},_setCurrentPane:function(a){a.addClass(f.CURRENT_PANE).removeClass(f.DISMISS_PANE).removeClass(f.SLID_PANE),this.$currentPane=a},_setLevelData:function(){var b,c=this.$original.children("ul"),d="> li > ul ";for(c.attr("data-level",a.uniqueId());;){var e=c.find(d),f=0;if(!e.length)break;e.each(function(c,d){var e=a(d),g=e.parents("ul").first(),h=g.attr("data-level"),i=parseInt(h.toString().split(".").pop());i!==b&&(b=i,f=0),e.attr("data-level",h+"."+f),console.info(e.attr("data-level")),f++}),d+="> li > ul"}},_setAnimationDefaults:function(){this.animationDefaults={easing:this.options.easing,duration:this.options.duration,mobileHA:!0}},_isAnimating:function(){return this.$navitron.hasClass(f.ANIMATING)},_getParentLevel:function(a){var b=a.toString().split(".");return b.pop(),b.join(".")},_getTargetPane:function(a){return this.$navitron.find(e.PANE+'[data-level="'+a+'"]')},_getTranslateX:function(a){return parseFloat(c.CSS.getPropertyValue(a[0],"translateX"))},_addAccessibility:function(){this.$navitron.attr("role","tree"),this.$navitron.find(e.PANE).each(function(b,c){var d=a(c),e=d.data("level");d.attr("role","group").attr("aria-hidden","true").attr("id","Navitron_"+e)}),this.$navitron.find(e.CURRENT_PANE).attr("aria-hidden","false"),this.$navitron.find(e.ITEM).attr("role","treeitem"),this.$navitron.find(e.NEXT_PANE).each(function(b,c){var d=a(c),e=d.data("target-pane");d.attr("aria-expanded","false").attr("aria-owns","Navitron_"+e)})},_validateOptions:function(){if(this.options.fadeOpacityTo<0||this.options.fadeOpacityTo>1)throw new Error("The fadeOpacityTo option value should be in the range from 0 to 1.0.");if(isNaN(this.options.shiftAmount))throw new Error("The shiftAmount option value needs to be an integer.");if(this.options.shiftAmount<0||this.options.shiftAmount>100)throw new Error("The shiftAmount option value should be in the range from 0 to 100.")}}),a("[data-navitron]").navitron(),a});